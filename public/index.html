<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PKCE Login</title>
</head>
<body>
  <h1>PKCE Login Flow</h1>
  <div id="content">You are not logged in.</div>
  <button id="login">Login</button>
  <button id="logout" style="display:none;">Logout</button>

  <script src="https://global.oktacdn.com/okta-auth-js/7.2.2/okta-auth-js.min.js"></script>
  <script>
    const oktaAuth = new OktaAuth({
      issuer: 'https://trial-1584011.okta.com/oauth2/default',
      clientId: '0oas1r4u9sS1e5tLh697',
      redirectUri: window.location.origin + '/callback',
      scopes: ['openid', 'email', 'profile'],
      pkce: true
    });

    async function handleLogin() {
      await oktaAuth.token.getWithRedirect();
    }

    async function handleLogout() {
      await oktaAuth.signOut();
    }

    async function handleCallback() {
      if (window.location.pathname === '/callback') {
        const tokens = await oktaAuth.token.parseFromUrl();
        oktaAuth.tokenManager.setTokens(tokens.tokens);
        window.history.replaceState({}, document.title, '/');
      }
    }

    async function checkSession() {
      const user = await oktaAuth.token.getUserInfo().catch(() => null);
      if (user) {
        document.getElementById('content').textContent = `Hello, ${user.email}`;
        document.getElementById('logout').style.display = 'inline-block';
        document.getElementById('login').style.display = 'none';
      }
    }

    document.getElementById('login').addEventListener('click', handleLogin);
    document.getElementById('logout').addEventListener('click', handleLogout);

    handleCallback().then(checkSession);
  </script>
</body>
</html>
